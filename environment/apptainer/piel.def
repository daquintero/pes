Bootstrap: docker
From: efabless/openlane


%post
    yum -y update
    yum install -y bzip2 wget
    
    # Install micromamba
    apt-get update && apt-get install -y wget
    wget -qO- https://micromamba.snakepit.net/api/micromamba/linux-64/latest | tar -xvj bin/micromamba
    mkdir -p /opt/micromamba
    mv bin/micromamba /opt/micromamba/micromamba
    chmod +x /opt/micromamba/micromamba
    export PATH=/opt/micromamba:$PATH
    

    # Create pielenv environment in micromamba
    micromamba shell init -s bash 
    micromamba create -p /opt/envs/pielenv -c conda-forge python=3.10.9    

%environment
    export PATH=/opt/micromamba:$PATH
    export PIEL_DIRECTORY="/opt/piel/"

%files
    /home/dq16394/piel/ /opt/ # If development

%runscript
    micromamba shell init -s bash
    micromamba run -p /opt/envs/pielenv pip install -r $PIEL_DIRECTORY/requirements_dev.txt
    micromamba run -p /opt/envs/pielenv pip install -e $PIEL_DIRECTORY

    # eval "$(micromamba shell hook --shell bash )"
    # micromamba activate /opt/envs/pielenv
    # /opt/envs/pielenv run pip install -r $PIEL_DIRECTORY/requirements_dev.txt
    # /opt/envs/pielenv run pip install -e $PIEL_DIRECTORY
    echo $PIEL_DIRECTORY

%startscript
    micromamba shell init -s bash
    micromamba run -p /opt/envs/pielenv pip install -r $PIEL_DIRECTORY/requirements_dev.txt
    micromamba run -p /opt/envs/pielenv pip install -e $PIEL_DIRECTORY

    # eval "$(micromamba shell hook --shell bash )"
    # micromamba activate /opt/envs/pielenv
    # /opt/envs/pielenv run pip install -r $PIEL_DIRECTORY/requirements_dev.txt
    # /opt/envs/pielenv run pip install -e $PIEL_DIRECTORY
    echo $PIEL_DIRECTORY

